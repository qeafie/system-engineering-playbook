<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ADR - system-engineering-playbook</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/_assets/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">system-engineering-playbook</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="Архитектурные-Решения-adr-для-Системы-Первичного-hr-Скрининга"><a class="header" href="#Архитектурные-Решения-adr-для-Системы-Первичного-hr-Скрининга">Архитектурные Решения (ADR) для Системы Первичного HR-Скрининга</a></h1>
<h2 id="adr-001-Выбор-архитектурного-стиля--Микросервисы-с-event-driven-на-apache-kafka"><a class="header" href="#adr-001-Выбор-архитектурного-стиля--Микросервисы-с-event-driven-на-apache-kafka">ADR-001: Выбор архитектурного стиля — Микросервисы с Event-Driven на Apache Kafka</a></h2>
<p><strong>Решение</strong>: Принята микросервисная архитектура с шиной событий Apache Kafka. Компоненты системы разделены на функциональные модули, взаимодействующие через асинхронные сообщения.</p>
<h3 id="Обоснование"><a class="header" href="#Обоснование">Обоснование:</a></h3>
<ol>
<li>
<p><strong>Обработка видеопотока в реальном времени</strong>: Модуль AI-интервьюера должен обрабатывать медиаданные с задержкой менее 2 секунд. Выделенный микросервис для медиа (WebRTC SFU) может масштабироваться горизонтально независимо от других компонентов.</p>
</li>
<li>
<p><strong>Генерация адаптивных вопросов</strong>: Модуль вопросов, основанный на ollama + qwen3, требует значительных вычислительных ресурсов (GPU). Микросервисная архитектура позволяет развертывать его на отдельном GPU-кластере и масштабировать по количеству активных сессий.</p>
</li>
<li>
<p><strong>Надежность и журналирование операций с ПДн</strong>: Модуль безопасности и соответствия 152-ФЗ должен гарантированно фиксировать все события, связанные с персональными данными. Event-driven подход с Kafka обеспечивает гарантированную доставку и сохранение этих событий для последующего аудита.</p>
</li>
<li>
<p><strong>Горизонтальная масштабируемость</strong>: Требование поддерживать до 100 одновременных сессий делает монолитную архитектуру неэффективной. Микросервисы позволяют добавлять инстансы только тех компонентов, которые испытывают нагрузку (например, модули анализа эмоций pyAudioAnalysis и EmotiEffLib).</p>
</li>
<li>
<p><strong>Процесс работы из технического задания</strong>: Шаги системы (получение согласия → проведение интервью → анализ → генерация отчета → решение HR) естественным образом ложатся на цепочку взаимодействующих сервисов. Kafka выступает в роли клея, передавая данные о завершении одного этапа для начала следующего.</p>
</li>
</ol>
<hr />
<h2 id="adr-002-Выбор-моделей-и-технологий-искусственного-интеллекта"><a class="header" href="#adr-002-Выбор-моделей-и-технологий-искусственного-интеллекта">ADR-002: Выбор моделей и технологий искусственного интеллекта</a></h2>
<p><strong>Решение</strong>: Применен гибридный стек AI-технологий с локальным развертыванием:</p>
<ul>
<li><strong>Распознавание речи</strong>: Whisper (MIT license).</li>
<li><strong>Анализ эмоций</strong>: pyAudioAnalysis (8 базовых эмоций) в связке с EmotiEffLib (43 параметра микровыражений).</li>
<li><strong>Генерация адаптивных вопросов</strong>: Модель qwen3, развернутая через фреймворк ollama.</li>
</ul>
<h3 id="Обоснование-1"><a class="header" href="#Обоснование-1">Обоснование:</a></h3>
<ol>
<li>
<p><strong>Для модуля распознавания речи (Whisper)</strong>:</p>
<ul>
<li><strong>Точность и поддержка языков</strong>: Показатель точности &gt;95% на русском языке соответствует заявленным требованиям. Поддержка множества языков позволяет работать с международными кандидатами.</li>
<li><strong>Лицензия и локализация</strong>: MIT-лицензия разрешает коммерческое использование. Модель может быть развернута на собственном GPU-оборудовании внутри периметра инфраструктуры заказчика, что является обязательным условием для обработки персональных данных (видео/аудио интервью) по 152-ФЗ.</li>
<li><strong>Производительность</strong>: Оптимизирована для трансформаторной архитектуры, что позволяет достичь требуемой скорости обработки потока.</li>
</ul>
</li>
<li>
<p><strong>Для модуля анализа эмоций (pyAudioAnalysis + EmotiEffLib)</strong>:</p>
<ul>
<li><strong>Комплексный анализ</strong>: Комбинация библиотек закрывает все требования: pyAudioAnalysis дает общую оценку по базовым эмоциям (радость, грусть, злость и т.д.) с точностью 82%, а EmotiEffLib предоставляет детализированный анализ микровыражений (коротких, непроизвольных движений лица), что является сильным индикатором искренности.</li>
<li><strong>Научная обоснованность</strong>: EmotiEffLib основана на системе кодирования лицевых движений (FACS), что повышает доверие к результатам анализа со стороны HR-специалистов.</li>
<li><strong>Открытый исходный код</strong>: Возможность доработки и адаптации моделей под специфические корпоративные сценарии.</li>
</ul>
</li>
<li>
<p><strong>Для модуля генерации вопросов (ollama + qwen3)</strong>:</p>
<ul>
<li><strong>Контекстная память 8000 токенов</strong>: Модель qwen3 поддерживает достаточно длинный контекст, чтобы "помнить" все предыдущие ответы кандидата в рамках 20-минутного интервью и строить уточняющие вопросы.</li>
<li><strong>Оценка 15+ компетенций</strong>: LLM-модель способна анализировать текстовую транскрипцию ответа на предмет проявления конкретных компетенций (лидерство, работа в команде, аналитическое мышление) и генерировать следующий вопрос для более глубокой проверки.</li>
<li><strong>Контроль и безопасность</strong>: Локальное развертывание через ollama исключает утечку вопросов и ответов к сторонним провайдерам, обеспечивая полный контроль над данными. Это критически важно, так как в ответах могут раскрываться коммерческие тайны или иная чувствительная информация.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="adr-003-Выбор-стратегии-хранения-данных"><a class="header" href="#adr-003-Выбор-стратегии-хранения-данных">ADR-003: Выбор стратегии хранения данных</a></h2>
<p><strong>Решение</strong>: Применена полиглотная архитектура хранения, где каждый тип данных обслуживается оптимальной для него системой:</p>
<ul>
<li><strong>PostgreSQL</strong> — для структурированных транзакционных данных.</li>
<li><strong>MinIO (S3-совместимое хранилище)</strong> — для больших бинарных объектов (видео).</li>
<li><strong>Redis</strong> — для кэширования и хранения состояний в реальном времени.</li>
<li><strong>Elasticsearch</strong> — для индексации, поиска и анализа логов.</li>
</ul>
<h3 id="Обоснование-для-каждого-хранилища"><a class="header" href="#Обоснование-для-каждого-хранилища">Обоснование для каждого хранилища:</a></h3>
<ol>
<li>
<p><strong>Для структурированных данных (PostgreSQL)</strong>:</p>
<ul>
<li><strong>ACID-транзакции и надежность</strong>: Обработка цифровых согласий на ПДн с электронной подписью (ГОСТ Р 34.10-2012) является юридически значимой операцией. Требуется гарантированная запись, целостность и консистентность данных, что обеспечивает PostgreSQL.</li>
<li><strong>Сложные запросы и связи</strong>: HR-интерфейсу необходимы сложные выборки, джойны и агрегации для фильтрации кандидатов, построения отчетов по вакансиям. Реляционная модель PostgreSQL идеально подходит для этого.</li>
<li><strong>Поддержка JSONB</strong>: Позволяет гибко хранить структурированные отчеты AI (оценки по компетенциям, эмоциональные профили) внутри реляционных таблиц, сочетая строгость схемы с гибкостью NoSQL.</li>
</ul>
</li>
<li>
<p><strong>Для видеоданных (MinIO)</strong>:</p>
<ul>
<li><strong>Объем и характер данных</strong>: Одна сессия интервью (20 минут, 1080p) занимает ~2 ГБ. При 100 сессиях в день объем хранения растет на 200 ГБ/день. Объектное хранилище эффективно и экономично для таких объемов.</li>
<li><strong>Надежность и доступность</strong>: MinIO обеспечивает отказоустойчивость через erasure coding, географическую репликацию для Disaster Recovery, что критично для сохранности персональных данных.</li>
<li><strong>Интеграция и шифрование</strong>: S3-совместимый API упрощает интеграцию. Поддерживает шифрование данных на стороне сервера (SSE), что является требованием для защиты ПДн по 152-ФЗ.</li>
</ul>
</li>
<li>
<p><strong>Для данных реального времени (Redis)</strong>:</p>
<ul>
<li><strong>Скорость доступа</strong>: Текущее состояние сессии (последний заданный вопрос, накопленный контекст для LLM, метрики качества связи) должно быть доступно с латенси менее 10 мс для обеспечения плавного диалога.</li>
<li><strong>Временные данные</strong>: Сессии интервью имеют ограниченный срок жизни (минуты/часы). Redis с TTL (time-to-live) идеально подходит для таких данных, автоматически очищая память.</li>
<li><strong>Механизм Pub/Sub</strong>: Используется для рассылки уведомлений HR-менеджерам о новых отчетах через WebSocket, что соответствует требованию swipe-интерфейса для быстрого принятия решений.</li>
</ul>
</li>
<li>
<p><strong>Для логов и поиска (Elasticsearch)</strong>:</p>
<ul>
<li><strong>Требования к журналированию</strong>: 152-ФЗ обязывает вести журнал всех операций с персональными данными. Elasticsearch позволяет индексировать миллионы логов и выполнять быстрый полнотекстовый и структурированный поиск для внутреннего аудита или запросов от регулятора.</li>
<li><strong>Аналитика и мониторинг</strong>: Kibana поверх Elasticsearch позволяет строить дашборды для мониторинга метрик производительности (uptime 99.5%, время генерации отчета) и бизнес-показателей (конверсия кандидатов).</li>
</ul>
</li>
</ol>
<hr />
<h2 id="adr-004-Выбор-брокера-сообщений-и-механизмов-межсервисного-взаимодействия"><a class="header" href="#adr-004-Выбор-брокера-сообщений-и-механизмов-межсервисного-взаимодействия">ADR-004: Выбор брокера сообщений и механизмов межсервисного взаимодействия</a></h2>
<p><strong>Решение</strong>: Использована многоуровневая система коммуникаций:</p>
<ul>
<li><strong>Apache Kafka</strong> — как основная шина событий (event bus) для потоковой обработки и гарантированной доставки.</li>
<li><strong>gRPC</strong> — для низколатентного RPC-взаимодействия между внутренними сервисами.</li>
<li><strong>REST/GraphQL</strong> — для публичного API и интеграций.</li>
<li><strong>WebRTC</strong> — для передачи медиапотоков от клиента.</li>
<li><strong>WebSocket</strong> — для push-уведомлений в HR-интерфейс.</li>
</ul>
<h3 id="Обоснование-2"><a class="header" href="#Обоснование-2">Обоснование:</a></h3>
<ol>
<li>
<p><strong>Для событийной шины (Apache Kafka)</strong>:</p>
<ul>
<li><strong>Обработка потока видеоданных</strong>: Kafka способен поглощать высокоскоростной поток сообщений (кадры видео, аудиосэмплы) от медиасервера и распределять их по потребителям — сервисам распознавания речи и анализа эмоций.</li>
<li><strong>Гарантированный порядок и доставка</strong>: События в рамках одной сессии интервью должны быть обработаны в строгом порядке. Гарантии доставки и порядок внутри партиции Kafka критичны для контекстной логики диалога.</li>
<li><strong>Журнал событий для аудита</strong>: Все значимые действия (подписание согласия, начало/конец интервью, доступ HR к отчету) публикуются в Kafka для последующего аудита.</li>
</ul>
</li>
<li>
<p><strong>Для внутренних RPC-вызовов (gRPC)</strong>:</p>
<ul>
<li><strong>Производительность и эффективность</strong>: Взаимодействие между сервисами требует минимальной задержки и высокой пропускной способности. Протокол gRPC значительно эффективнее текстового REST/JSON.</li>
<li><strong>Поддержка потоковой передачи</strong>: Позволяет передавать данные анализа от AI-сервисов к сервису отчетности в реальном времени.</li>
</ul>
</li>
<li>
<p><strong>Для внешних интеграций (REST/GraphQL)</strong>:</p>
<ul>
<li><strong>Интеграция с ATS</strong>: Эти системы ожидают взаимодействия по стандартным REST API. GraphQL предлагается для продвинутых клиентов, позволяя запрашивать именно те данные, которые нужны.</li>
</ul>
</li>
<li>
<p><strong>Для медиакоммуникаций (WebRTC)</strong>:</p>
<ul>
<li>WebRTC является лучшим решением для передачи видео и аудио с камеры в браузере с минимальной задержкой.</li>
</ul>
</li>
<li>
<p><strong>Для уведомлений UI (WebSocket)</strong>:</p>
<ul>
<li><strong>Swipe-интерфейс для HR</strong>: Для мгновенного обновления списка кандидатов и уведомлений используется WebSocket.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="Итоги"><a class="header" href="#Итоги">Итоги</a></h3>
<p>Представленный набор архитектурных решений формирует основу для системы, которая:</p>
<ul>
<li>Выполняет функциональные требования: Обеспечивает проведение AI-интервью с анализом речи, эмоций и генерацией адаптивных вопросов.</li>
<li>Соответствует нефункциональным требованиям: Достигает производительности (100 одновременных сессий, отчет за &lt;5 мин), надежности (99.5% uptime, ACID) и безопасности (152-ФЗ "из коробки").</li>
<li>Обеспечивает масштабируемость и гибкость: Микросервисная архитектура с полиглотным хранением и event-driven взаимодействием позволяет системе расти и адаптироваться к новым требованиям.</li>
</ul>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pages/component-schema.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pages/swagger.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pages/component-schema.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pages/swagger.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
